doctype html
html(lang="en")
  head
    title Yehaa playlist viewer
    link(href='/css/yehaa.css', rel='stylesheet')
    script(src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js")
    script(type='text/javascript').
      // After the API loads, call a function to enable the search box.
      var playlists = !{JSON.stringify(playlists)}
      function handleAPILoaded() {
        //$('#search-button').attr('disabled', false);
      }

      // Search for a specified string.
      function search() {
        var q = playlists[$('#pl-select').val()];
        var request = gapi.client.youtube.search.list({
          q: q,
          part: 'snippet'
        });

        request.execute(function(response) {
          //var str = JSON.stringify(response.result);
         // console.log(response);
         //TODO error handling
          $("#result-list").empty();
          response.result.items.forEach(displayPlaylistItem);
        });
      }
      function displayPlaylistItem(element, index, array){
        $("#result-list").append("<li><img src="+ element.snippet.thumbnails.default.url+"><span>"+element.snippet.title+"</span></li>");
      }
      function init(){
        gapi.client.setApiKey(!{JSON.stringify(apiKey)});
        gapi.client.load('youtube', 'v3' , handleAPILoaded);
      }
    script(src="https://apis.google.com/js/client.js?onload=init")
  body.bodyClass
    select#pl-select(onchange="search()")
      each playlist, index in playlists
        option(value=index)= playlist
    #search-container
      ul#result-list
        each item in data.items
          li
            img(src=item.snippet.thumbnails.default.url)
            span= item.snippet.title